@model SuiPOS.ViewModels.ProductInputVM

@{
    ViewData["Title"] = (Model.Id == null || Model.Id == Guid.Empty) ? "Tạo sản phẩm mới" : "Chỉnh sửa sản phẩm";
}

<div class="min-h-screen bg-gray-50 py-6 px-6">
    <div class="max-w-7xl mx-auto">
        <div class="flex items-center justify-between mb-6">
            <h1 class="text-3xl font-bold text-gray-900">@ViewData["Title"]</h1>
            <a href="@Url.Action("Index", "Products")" class="px-4 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center gap-2">
                <i class="fas fa-arrow-left"></i> Quay lại
            </a>
        </div>

        <form id="productForm" enctype="multipart/form-data">
            @Html.AntiForgeryToken()
            <input type="hidden" asp-for="Id" />
            <input type="hidden" asp-for="ExistingImageUrl" />

            <div asp-validation-summary="ModelOnly" class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4"></div>

            <div class="flex justify-between gap-5">
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6 w-1/3">
                    <h2 class="text-xl font-bold text-gray-900 mb-2 flex items-center gap-2">Hình ảnh</h2>
                    <div class="mt-6">
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                            <input asp-for="ImageFile" type="file" id="imageFile" accept="image/*" class="hidden" onchange="previewImage(event)" />

                            <div id="uploadArea" class="@(string.IsNullOrEmpty(Model.ExistingImageUrl) ? "" : "hidden")">
                                <i class="fas fa-image text-6xl text-gray-300 mb-4"></i><br />
                                <button type="button" onclick="document.getElementById('imageFile').click()" class="px-4 py-2 bg-blue-600 text-white rounded-lg">Thêm ảnh</button>
                            </div>

                            <div id="imagePreview" class="@(string.IsNullOrEmpty(Model.ExistingImageUrl) ? "hidden" : "") mt-4">
                                <img id="previewImg" src="@(Model.ExistingImageUrl ?? "")" class="max-h-64 mx-auto rounded-lg shadow-md" />
                                <button type="button" onclick="removeImage()" class="mt-3 text-red-600 hover:text-red-800"><i class="fas fa-trash mr-2"></i>Xóa ảnh</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-sm p-6 mb-6 flex-1">
                    <h2 class="text-xl font-bold text-gray-900 mb-6">Thông tin chung</h2>
                    <div class="space-y-6">
                        <div>
                            <label asp-for="Name" class="block text-sm font-medium text-gray-700 mb-2">Tên sản phẩm</label>
                            <input asp-for="Name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Nhập tên sản phẩm" />
                            <span asp-validation-for="Name" class="text-red-500 text-sm"></span>
                        </div>

                        <div class="grid grid-cols-2 gap-6">
                            <div>
                                <label asp-for="CategoryId" class="block text-sm font-medium text-gray-700 mb-2">Loại</label>
                                <select asp-for="CategoryId" asp-items="ViewBag.Categories" class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                    <option value="">Chọn loại sản phẩm</option>
                                </select>
                                <span asp-validation-for="CategoryId" class="text-red-500 text-sm"></span>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Giá niêm yết</label>
                                <div class="relative">
                                    <input type="number" id="basePrice" class="w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="0" value="@(Model.Variants?.FirstOrDefault()?.Price ?? 0)" />
                                    <span class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500">₫</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-gray-900">Biến thể</h2>
                    <span class="text-sm font-medium text-gray-700" id="variantCount">0 Biến thể</span>
                </div>

                <div id="attributesContainer"></div>

                <button type="button" onclick="addAttributeRow()" class="text-blue-600 hover:text-blue-800 flex items-center gap-2 mb-6">
                    <i class="fas fa-plus-circle"></i> Thêm thuộc tính khác
                </button>

                <div id="variantsContainer" class="space-y-3 border-t pt-6">
                    <p class="text-gray-500 text-sm text-center py-4">Chưa có biến thể nào được tạo</p>
                </div>
            </div>

            <div class="flex justify-end gap-3">
                <a href="@Url.Action("Index", "Products")" class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50">Hủy</a>
                <button type="submit" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2">
                    <i class="fas fa-save"></i> @(Model.Id == null || Model.Id == Guid.Empty ? "Tạo sản phẩm" : "Lưu thay đổi")
                </button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        window.initialVariants = @Html.Raw(Json.Serialize(Model.Variants));
    </script>
    <script src="~/js/product-form.js"></script>
}